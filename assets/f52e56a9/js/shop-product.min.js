!function(a){"use strict";function b(){var b=a(".big-image .picture.active .preview-img"),c=b.position(),d=b.siblings(".hint");a(d).each(function(){var d=c.left+b.width()/100*a(this).attr("data-x"),e=c.top+b.height()/100*a(this).attr("data-y");a(this).css({left:d,top:e}).show()})}function c(b,c){var e;return this.each(function(){var f=a(this).data("ct-shopproduct"),g=a.extend({},d.DEFAULTS,a(this).data(),"object"==typeof b&&b);f||a(this).data("ct-shopproduct",f=new d(this,g)),"string"==typeof b&&(e=f[b](c))}),e||this}var d=function(b,c){var d=this;d.loader=null,d.options=c,d.$element=a(b),d.priceRequest=null,d.productConfiguratorRequest=null,d.onEvents(),d.onTabClick(),d.configuration(),d.slider(),d.preview(),d.marks(),d.tabOffset(),d.onModulesChange(),d.updateChoosedElements(),a(window).on("resize",function(){d.tabOffset()}),a(window).trigger("resize"),window.location.hash&&"#configuration"==window.location.hash&&d.onClickConfiguration.call(d)};d.DEFAULTS={shopProductId:!1,parameterValues:[],responceUrl:!1,sliderMode:"horizontal",priceUrl:"",orderCheckUrl:"",isModular:!1},d.prototype.onModulesChange=function(){var a=this,b=a.$element.find(".shop-product-modules .shop-product-module");b.size()&&(b.shopProductModule({onChange:function(){a.updateChoosedElements(),a.updatePrice()}}),a.updatePrice())},d.prototype.updateChoosedElements=function(){var b=this,c=b.$element.find(".choosed-elements-content").empty();b.$element.find(".shop-product-modules .shop-product-module").each(function(){a(this).shopProductModule("isEnabled")&&c.append(a('<li class="module"><span class="module__count">'+a(this).find(".item-quantity").val()+'</span><div class="module__title">'+a(this).data("module-title")+"</div></li>"))})},d.prototype.updatePrice=function(){var b=this,c=b.collectInfoForBuying();return b.priceRequest&&b.priceRequest.abort(),b.priceRequest=a.ajax({url:b.options.priceUrl,data:c,method:"post",success:function(c){b.priceRequest=null,b.$element.find(".buy-info .price-value:first").html(c.price.view),a(".fastorder-wrapper .fast-order-price").html(c.price.view),c.modules.forEach(function(c){b.$element.find('.shop-product-modules .shop-product-module[data-module-id="'+c.id+'"]').each(function(){a(".price-value",a(this)).html(c.price.view)})})}}),b.priceRequest},d.prototype.marks=function(){function c(b){b.addClass("fadeOutUp"),b.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a(this).hide(),a(this).off()})}function d(a){a.removeClass("fadeOutUp").show()}a(".big-image .picture.active .preview-img").imagesLoaded().progress(function(a,c){b()}),a(window).resize(function(){b()}),a(".big-image .hint").click(function(b){b.preventDefault(),a(".big-image .hint.active").not(this).click(),a(this).toggleClass("active");var e=a(".info",a(this));a(this).hasClass("active")?d(e):c(e)})},d.prototype.modulesEnabledCount=function(){var b=0;return this.$element.find(".shop-product-modules .shop-product-module").each(function(){a(this).shopProductModule("isEnabled")&&b++}),b},d.prototype.showModuleAlert=function(){sweetAlert({title:"Дорогой друг!",text:"Для того, чтобы добавить товар в корзину, необходимо выбрать хотя бы один элемент",type:"warning",showConfirmButton:!1,allowOutsideClick:!0})},d.prototype.collectInfoForBuying=function(){var b=this,c={shopProductId:b.options.shopProductId,parameterValues:[]};return a(".buy-info-params select.parameter-value").each(function(){var b=a(this).val();b&&(a.isArray(b)?a(b).each(function(){c.parameterValues.push({id:this,count:1})}):c.parameterValues.push({id:b,count:1}))}),b.$element.find(".shop-product-modules .shop-product-module").each(function(){var b=a(this).data("module-id"),d=a(this).find(".item-quantity").val();c.parameterValues.push({id:b,count:d})}),(a(this).hasClass("credit")||a("#credit-calculator").is(":visible"))&&(c.isCredit=1),(a(this).hasClass("installment")||a("#installment-popup").is(":visible"))&&(c.isCredit=1),c},d.prototype.onEvents=function(){var b=this;a(".tocart").click(function(c){if(c.preventDefault(),b.options.isModular&&0==b.modulesEnabledCount())return b.showModuleAlert(),!1;var d=b.collectInfoForBuying(),e=this.getAttribute("data-bem");if(e){var f=a(".buy-info .price-value").html(),g=+(f.substr(0,f.search("<span")).replace(/\D/g,"")||0);d.data=JSON.parse(e),g&&(a.isArray(d.data.price)?d.data.price[0]=g:d.data.price=g)}d.cart_widget="sidebar",a.cart("putWithSidebar",d),a(this).replaceWith(a(this).clone().attr("href",b.options.orderCheckUrl).text("В КОРЗИНЕ"))}),a(document).on("click",".buy-info .credit",function(){var b=a(".buy-info:first").offset();return a("#credit-calculator").css("top",98+b.top+"px").fadeIn(300),yii.analytics.triggerEvent("CREDIT_CACLULATOR"),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&a("#credit-calculator .monthly-payment").css("border-bottom","3px solid #ddd"),a(window).height()+a(window).scrollTop()<b.top+357?a("html, body").animate({scrollTop:b.top-230}):a(window).scrollTop()>b.top+50&&a("html, body").animate({scrollTop:b.top-50}),!1}),a(".go-to-configurations").click(function(b){a("body, html").animate({scrollTop:a(".product-other-configurations").offset().top},400)}),a(".quick-order").click(function(c){c.preventDefault(),b.options.isModular&&0==b.modulesEnabledCount()&&b.showModuleAlert();var d=b.collectInfoForBuying();a("#quickorderform-parametervaluesjson").val(JSON.stringify(d.parameterValues)),window.ga("send","pageview","/virtual/fast-buy/"),yii.analytics.triggerEvent("EC_QUICKORDER"),yii.analytics.triggerEvent("EC_PC_QUICKORDER"),a(".fastorder-wrapper .title span").html(a(".buy-info .price-value").html()),a(".fastorder-wrapper").blurdialog("show")}),a(".addCompare").click(function(a){a.preventDefault(),yii.compareList.putProduct(b.options.shopProductId)}),a(".responses-container").on("click",".response",function(c){c.preventDefault();var d=a(this),e={responseId:d.data("response-id")};d.hasClass("usefull")?e.isUsefull=1:e.isUsefull=0,a.get(b.options.responceUrl,e,function(a){if(a.result){var b;b=d.hasClass("usefull")?a.usefull_count:a.useless_count,d.find("span").text(b)}else alert("Произошла ошибка. Попробуйте чуть позже.")},"json")}),a(document).keydown(function(b){27==b.keyCode?a(".zoom-window:visible .close").click():-1!=[37,38,100,104].indexOf(b.keyCode)?a(".zoom-window:visible .zoom-navi span:first").click():-1!=[12,13,39,40,98,102].indexOf(b.keyCode)&&a(".zoom-window:visible .zoom-navi span:last").click()}),a(".yashare-link").click(function(){return a(this).parent().find(".yashare-auto-init").each(function(){a(this).is("[style]")?a(this).removeAttr("style"):a(this).css("display","block")}),!1}),a(".shop-product-files:first").each(function(){var b=a(this),c=a(".buy-info:first");a(window).resize(function(){b.css("margin-right",(b.offset().top>c.offset().top+c.outerHeight()?-386:-30)+"px")})})},d.prototype.configuration=function(){var b=a(".configure");b.length&&b.on("click",this.onClickConfiguration.bind(this)).on("mouseenter",this.onMouseEnterConfiguration.bind(this))},d.prototype.onMouseEnterConfiguration=function(){var b=this;return!b.productConfiguratorRequest&&(a(".buy-info-configuration").html()||(b.productConfiguratorRequest=a.get(b.options.configurationUrl+"/"+b.options.shopProductId)),!1)},d.prototype.onClickConfiguration=function(){var b=this,c=a(".buy-info-configuration");if(!b.productConfiguratorRequest){if(c.html())return a.configuration("show"),!1;b.productConfiguratorRequest=a.get(b.options.configurationUrl+"/"+b.options.shopProductId)}return"pending"==b.productConfiguratorRequest.state()?b.loader||(b.loader=a('<div class="configuration-dialog-placeholder"></div>').one("ct-configurator-cupboard.beforeHide ct-configurator-sofa.beforeHide","*",function(){return b.loader.blurdialog("hide","visible"),!1}),b.loader.blurdialog(),b.productConfiguratorRequest.then(function(c){b.loader.append(c),a.configuration("integrate")}),setTimeout(function(){b.loader.blurdialog("show")},0)):b.loader?a.configuration("show"):(b.loader=!0,b.productConfiguratorRequest.then(function(b){c.html(b),a.configuration("show")})),!1},d.prototype.slider=function(){var c,d=this,e=a(".element-slider"),f=e.children().length,g=Math.min(4,f),h=Math.min(8,f);c="horizontal"==d.options.sliderMode?84:52,window.mainSlider=e.bxSlider({mode:d.options.sliderMode,minSlides:g,maxSlides:h,slideWidth:c,slideMargin:10,moveSlides:1,pager:!1,nextText:"",prevText:"",controls:f>4,onSliderLoad:function(){var e=a(".big-image .bx-controls, .catalog-element .bx-wrapper");e.addClass(d.options.sliderMode),f<=7&&"horizontal"==d.options.sliderMode&&e.css("width",f*(c+2)+10*(f-1));var g=a("<div/>",{class:"left-shadow"}),h=a("<div/>",{class:"right-shadow"}),i=a("<i/>"),j=a("<i/>");a(".catalog-element .bx-controls-direction").prepend(g,h),a(".catalog-element .bx-controls-direction .bx-prev").prepend(i),a(".catalog-element .bx-controls-direction .bx-next").prepend(j),"vertical"==d.options.sliderMode&&e.outerHeight()<a(".slider-container").height()&&e.css("marginTop",(a(".slider-container").height()-e.outerHeight())/2),a(".element-slider > a").click(function(c){if(a(this).is(".youtube-video-gallery-preview"))return a(".features-list:first .features-item:eq("+a(this).attr("rel")+") .youtube-video:first").click(),!1;c.preventDefault();var d=a(this).data("id");a(".big-image div.active").stop().animate({opacity:0},function(){a(this).css("display","none").removeClass("active"),a(".big-image div[data-id="+d+"]").css({display:"block",opacity:"0"}).animate({opacity:1},function(){a(this).addClass("active"),b(),a(".big-image .hint.active").removeClass("active").find(".info").hide()})})})}})},d.prototype.preview=function(){a(document).on("click",".catalog-element .big-image .picture .picture-shield",function(b){b.stopPropagation(),a(this).prev(".preview-img").click()}),a(document).on("click",".catalog-element .big-image .picture img.preview-img",function(){var b=a(".big-image .hint.active");if(b.size()>0)return void b.removeClass("active").find(".info").hide();a(".zoom-window").remove(),a("body").css({overflow:"hidden"}).append('<div class="zoom-window"><div class="previews"><ul></ul></div><div class="close"><a></a><i></i></div></div>');var c=a(this),d=a(".zoom-window"),e=c.offset(),f=e.top-a(document).scrollTop(),g=e.left,h=e.top-a(document).scrollTop()+c.height(),i=e.left+c.width(),j=a("html");d.css({clip:"rect("+f+"px, "+i+"px, "+h+"px, "+g+"px)"}),d.data("clip","rect("+f+"px, "+i+"px, "+h+"px, "+g+"px)"),d.css({clip:"rect(0px, "+j.width()+"px, "+j.height()+"px, 0px)"});var k=new Image;k.src=c.attr("src"),k.onload=function(){d.addClass("show").each(function(){a("img:first",this).remove()}).prepend(k);var b=d.find("img:first"),c=b.width(),e=b.height(),f=d.width(),g=d.height(),h=70,i=60,l=d.find(".previews ul").empty();(c>f-2*h-l.width()||e>g-2*i)&&(c/e>(f-2*h-l.width())/(g-2*i)?a(this).width(f-2*h-l.width()):a(this).height(g-2*i),c=a(this).width(),e=a(this).height()),b.css({"margin-left":h+Math.max(0,(f-c-2*h-l.width())/2)+l.width()-5+"px","margin-top":i+Math.max(0,(g-e-2*i)/2)+"px",position:"absolute"});var m=a(".catalog-element .big-image .picture");if(m.length){m.each(function(d){var j=a("<img>").attr("src",a(this).data("preview"));j[0].onload=function(){a(this).addClass("loaded")},a(this).hasClass("video")&&(j[0].onload=function(){a(this).css({width:"117px"}),a(this).addClass("youtube-video-gallery-preview"),a(this).after('<span class="play__icon_2"></span>')}),a("img:first",this).attr("src")==b.attr("src")&&j.addClass("current"),l.append(a("<li></li>").html(a("<a></a>").data("src",a("img:first",this).attr("src")).html(j).click(function(){var d=a(this);return d.parent().is(":last-child")?n.scrollToPercentY(100):"object"==typeof n&&n.scrollToElement(d.parent()),d.closest(".previews").find("img").removeClass("current"),d.find("img").addClass("current"),a(this).find("img").hasClass("youtube-video-gallery-preview")?(b.animate({opacity:0},function(){function b(b){c=!0;var d=a(b).html();a(".zoom-window img").first().after('<div class="'+a(b).attr("class")+'">'+d+"</div>");var e=a(window).width(),f=a(window).height(),g=a(".zoom-window > div.youtube-video-dialog").width(),h=a(".zoom-window > div.youtube-video-dialog").height(),i=g/h,j=a(".zoom-window > div.previews").width(),k=20,l=e-j-2*k-g;if(l>0)var m=parseInt(l/2)+k+j;else{g-=Math.abs(l),h=parseInt(g/i);var m=k+j}var n=f-2*k-h;if(n>0)var o=parseInt(n/2)+k;else{h-=Math.abs(n),g=parseInt(h*i);var o=k;l=e-j-2*k-g,m=parseInt(l/2)+k+j}a(".zoom-window > div.youtube-video-dialog").css({"z-index":"1000000",width:g,height:h,"margin-left":m,"margin-top":o,top:"0",left:"0"})}var c=!1;a(".features-list:first .features-item .youtube-video:first > div").each(function(){a(this).hasClass("youtube-video-dialog")&&(b(this),c=!0)}),c||a(".blur-dialog > div").each(function(){a(this).hasClass("youtube-video-dialog")&&b(this)})}),a(".zoom-window > div.youtube-video-dialog").animate({opacity:1})):(a(".zoom-window > div.youtube-video-dialog").animate({opacity:0}).remove(),b.animate({opacity:0},function(){a(this)[0].onload=function(){a(this).css({width:"auto",height:"auto"}).each(function(){c=a(this).width(),e=a(this).height(),(c>f-2*h-l.width()||e>g-2*i)&&(c/e>(f-2*h-l.width())/(g-2*i)?a(this).width(f-2*h-l.width()):a(this).height(g-2*i),c=a(this).width(),e=a(this).height()),b.css({"margin-left":h+Math.max(0,(f-c-2*h-l.width())/2)+l.width()-5+"px","margin-top":i+Math.max(0,(g-e-2*i)/2)+"px"})}).animate({opacity:1})},a(this).attr("src",d.data("src"))})),!1})))}),m.length>1&&(d.append(a('<div class="zoom-navi"><span></span><span class="next"></span><b></b></div>')),d.find(".zoom-navi span").click(function(){a(this).hasClass("next")?l.find("li:has(.current)").is(":last-child")?l.find("a:first").click():l.find("li:has(.current)").next().find("a").click():l.find("li:has(.current)").is(":first-child")?l.find("a:last").click():l.find("li:has(.current)").prev().find("a").click()}),d.find(".zoom-navi b").click(function(b){a(this).parent().find("span:last").click()}),a(".zoom-navi").before('<div style="width: '+h+'px; height: 100%; position: absolute; left: 225px; z-index: 2;"></div>'),a(".zoom-navi").before('<div style="width: '+(20+h)+'px; height: 100%; position: absolute; right: 0; z-index: 2;"></div>'));var n;!function b(){l.find("img:not(.loaded)").length?setTimeout(b,150):(n=l.parent().jScrollPane({verticalDragMaxHeight:150,mouseWheelSpeed:100,animateScroll:!0}).data("jsp"),l.find("li:first").parent().each(function(){a(this).css("top",Math.max(0,(a(this).closest(".jspContainer").height()-a(this).height())/2-17)+"px")}))}()}a(window).resize(function(){"object"==typeof n&&n.reinitialise(),f=j.width(),g=j.height(),d.css({clip:"rect(0px, "+f+"px, "+g+"px, 0px)"}),a(".current",l).parent().click().parent().parent().each(function(){a(this).css("top",Math.max(0,(a(this).closest(".jspContainer").height()-a(this).height())/2)+"px")})})}}),a(document).on("click",".zoom-window",function(b){var c=a(this),d=a("html");(a(b.target).is(".close")||a(b.target).parent().is(".close"))&&(a(".big-image .hint.active").removeClass("active").find(".info").hide(),c.css({clip:"rect(0px, "+d.width()+"px, "+d.height()+"px, 0px)"}),c.css({clip:c.data("clip")}),setTimeout(function(){c.removeClass("show").attr("style",""),a(".zoom-window").remove(),a("body").css({overflow:"visible"})},500))}),a(document).on("click",".mg-glass",function(){a(".catalog-element .big-image .picture.active img.preview-img").trigger("click")})},d.prototype.onTabClick=function(){a(".product-description .product-tabs li").click(function(){a("body, html").animate({scrollTop:a(".product-tabs").offset().top},400),a(this).siblings().removeClass("active"),a(this).addClass("active"),a(".product-tabs-content .tab").removeClass("active"),a(".product-tabs-content .tab[data-id="+a(this).data("id")+"]").addClass("active")}),a("[data-tab-id]").click(function(){return a('.product-tabs li[data-id="'+a(this).data("tab-id")+'"]').click(),!1})},d.prototype.option=function(a){return this.options[a]},d.prototype.destroy=function(){this.$element.remove()},d.prototype.tabOffset=function(){var b=a(window).height(),c=a(".big-image").offset().top,d=a(".big-image").height(),e=a(".product-tabs").height(),f=b-(c+d+e);f>0&&f<31?a(".product-tabs").css("margin-top",f-30):a(".product-tabs").css("margin-top",0);var g=a(".product-description .data").outerHeight()+a(".product-description .buy-info_promo").outerHeight()-a(".pre-footer").height();a(".product-tabs-content").each(function(){a(this).css("min-height",g-parseInt(a(this).css("padding-top"))-parseInt(a(this).css("padding-bottom")))})},a.fn.shopproduct=c,a.fn.shopproduct.Constructor=d,a.shopproduct=function(b,c){return a("body").shopproduct(b,c)}}(jQuery);