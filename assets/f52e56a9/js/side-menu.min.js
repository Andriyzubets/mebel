"use strict";yii.sideMenu=function(a){function b(b){var c=a(b.currentTarget),d=n.filter(c.attr("href")).attr("data-more");return d&&(window.location.href=d),!1}function c(){m.click(function(a){return a.preventDefault(),B.addClass("side-menu-wide"),o.removeClass("active"),o.filter(".current").hasClass("search")?void A.click():!o.filter(".current").hasClass("no-submenu")&&(B.addClass("side-menu-open"),n.filter(".current").removeClass("current"),n.filter(o.filter(".current").find("a").attr("href")).addClass("show current"),setTimeout(function(){n.not(".current").removeClass("current show")},300),!1)}),p.click(function(a){a.preventDefault(),B.addClass("side-menu-wide")}),o.find("a:not(.static)").on("dblclick",b).on("click",function(c){var d=a(c.currentTarget),e=d.parent();return e.hasClass("active")?b(c):(B.addClass("side-menu-wide side-menu-open"),o.removeClass("active current"),e.addClass("active"),n.filter(".current").removeClass("current"),n.filter(d.attr("href")).addClass("show current"),setTimeout(function(){n.not(".current").removeClass("current show")},300),!1)}),n.find(".close-sub").click(function(a){a.preventDefault(),g()}),a(document).on("click",function(b){a(b.target).closest(l).length||!B.hasClass("side-menu-open")&&!B.hasClass("side-menu-wide")||(n.removeClass("show current"),B.removeClass("side-menu-open"),setTimeout(function(){B.removeClass("side-menu-wide"),o.removeClass("active current"),q.addClass("current")},300))}),A.click(function(){a(this).addClass("active"),y.children().size()>0?f():(B.addClass("side-menu-wide"),l.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){a(this).off("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),s.focus()}))}).focusout(function(){a(this).removeClass("active")}),s.keyup(function(){d()}),w.click(function(){r.submit()}),a(window).resize(function(){k()}),r.submit(function(){return 0==a('[name="no_cache"]',this).length&&a(this).append(a("<input />").attr({type:"hidden",name:"no_cache"}).val(1)),!0})}function d(){u!=s.val()&&(i(t),s.val()?t=setTimeout(function(){yii.analytics.triggerEvent("SEARCH_USE"),a.ajax({type:"GET",url:v,data:r.serialize(),dataType:"json",success:function(a){a?e(a):(y.empty(),h())}})},300):j(),u=s.val())}function e(a){f(),y.empty().html(a),k()}function f(){B.addClass("side-menu-wide side-menu-open"),l.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){a(this).off("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),s.focus()}),x.addClass("show current"),n.filter(".current").removeClass("current")}function g(){h(),setTimeout(function(){B.removeClass("side-menu-wide"),o.removeClass("active current"),q.addClass("current")},300)}function h(){n.removeClass("show current"),B.removeClass("side-menu-open")}function i(a){a&&clearTimeout(a)}function j(){s.val(""),u=""}function k(){y.height(x.height()-y.position().top-w.outerHeight())}var l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u="",v=null,w=null,x=null,y=null,z=null,A=null,B=null;return{init:function(){l=a(".side-menu"),m=a(".current-item-shadow",l),n=a(".menu-sub",l),o=a(".side-menu-items li",l),p=a(".open-short-menu",l),q=o.filter(".current"),A=a(".search-menu-item"),r=a("form[name=search-form]",l),s=a("input",r).empty(),v=l.attr("data-search-url")||"/search/ajax-results",x=a(".search-results",l),y=a(".search-results-content",x),w=a(".all-results",x),z=a(".menu-img",A),B=a("body"),o.each(function(){var b=a(".txt",this),c=this.style.backgroundColor;b.after('<span class="hint" style="background-color:'+c+'">'+b.text()+"</span>")}),n.each(function(){var b=this.getAttribute("data-more");b&&a(".menu-sub-description",this).eq(0).after('<div class="menu-sub-more"><a href="#">Посмотреть все</a></div>')}),c();var b=a(".new-subscribe-form");b.on("beforeSubmit",function(){return a.ajax({type:"POST",url:"/subscribe/subscribe2",data:b.serialize(),dataType:"json",success:function(c){"ok"!=c.status||(a(".subscribe-menu-form div#sf_container").hide(),a(".subscribe-menu-form div#subscribe-thanks-msg").fadeIn(1200),yii.analytics.triggerEvent("SUBSCRIBE_SENT"),directCrm("identify",{operation:"SubscribeThree",identificator:{provider:"email",identity:a("[name='SubscribeForm[email]']",b).val()||""},data:{fullName:""}}))}}),!1})}}}(jQuery);